{
	"version": 3,
	"names": [
		"clone",
		"extend",
		"rectUtils",
		"Modification",
		"states",
		"startOffset",
		"left",
		"right",
		"top",
		"bottom",
		"startDelta",
		"result",
		"endResult",
		"startEdges",
		"edges",
		"interaction",
		"constructor",
		"createResult",
		"start",
		"phase",
		"pageCoords",
		"modifierList",
		"getModifierList",
		"prepareStates",
		"getRectOffset",
		"rect",
		"x",
		"y",
		"arg",
		"fillArg",
		"preEnd",
		"startAll",
		"setAll",
		"interactable",
		"element",
		"state",
		"methods",
		"skipModifiers",
		"unmodifiedRect",
		"unmodifiedEdges",
		"coords",
		"slice",
		"newResult",
		"options",
		"lastModifierCoords",
		"returnValue",
		"set",
		"shouldDo",
		"addEdges",
		"eventProps",
		"push",
		"delta",
		"rectDelta",
		"prevCoords",
		"prevRect",
		"rectChanged",
		"changed",
		"applyToInteraction",
		"curCoords",
		"cur",
		"startCoords",
		"curDelta",
		"coordsSet",
		"page",
		"client",
		"width",
		"height",
		"setAndApply",
		"modifiedCoords",
		"length",
		"interacting",
		"adjustment",
		"beforeEnd",
		"event",
		"doPreend",
		"endPosition",
		"move",
		"stop",
		"modifierArg",
		"index",
		"name",
		"restoreInteractionCoords",
		"modification",
		"coordsAndDeltas",
		"requireEndOnly",
		"enabled",
		"endOnly",
		"setStart",
		"copyFrom",
		"other",
		"map",
		"s",
		"destroy",
		"prop",
		"actionOptions",
		"prepared",
		"actionModifiers",
		"modifiers",
		"type",
		"_methods",
		"filter",
		"m"
	],
	"sources": [
		"Modification.ts"
	],
	"sourcesContent": [
		"import type { EventPhase } from '@interactjs/core/InteractEvent'\nimport type { Interaction, DoAnyPhaseArg } from '@interactjs/core/Interaction'\nimport type { EdgeOptions, FullRect, Point, Rect } from '@interactjs/core/types'\nimport clone from '@interactjs/utils/clone'\nimport extend from '@interactjs/utils/extend'\nimport * as rectUtils from '@interactjs/utils/rect'\n\nimport type { Modifier, ModifierArg, ModifierState } from './types'\n\nexport interface ModificationResult {\n  delta: Point\n  rectDelta: Rect\n  coords: Point\n  rect: FullRect\n  eventProps: any[]\n  changed: boolean\n}\n\ninterface MethodArg {\n  phase: EventPhase\n  pageCoords: Point\n  rect: FullRect\n  coords: Point\n  preEnd?: boolean\n  skipModifiers?: number\n}\n\nexport default class Modification {\n  states: ModifierState[] = []\n  startOffset: Rect = { left: 0, right: 0, top: 0, bottom: 0 }\n  startDelta!: Point\n  result!: ModificationResult\n  endResult!: Point\n  startEdges!: EdgeOptions\n  edges: EdgeOptions\n  readonly interaction: Readonly<Interaction>\n\n  constructor (interaction: Interaction) {\n    this.interaction = interaction\n    this.result = createResult()\n    this.edges = {\n      left: false,\n      right: false,\n      top: false,\n      bottom: false,\n    }\n  }\n\n  start ({ phase }: { phase: EventPhase }, pageCoords: Point) {\n    const { interaction } = this\n    const modifierList = getModifierList(interaction)\n    this.prepareStates(modifierList)\n\n    this.startEdges = extend({}, interaction.edges)\n    this.edges = extend({}, this.startEdges)\n    this.startOffset = getRectOffset(interaction.rect, pageCoords)\n    this.startDelta = { x: 0, y: 0 }\n\n    const arg = this.fillArg({\n      phase,\n      pageCoords,\n      preEnd: false,\n    })\n\n    this.result = createResult()\n    this.startAll(arg)\n\n    const result = (this.result = this.setAll(arg))\n\n    return result\n  }\n\n  fillArg (arg: Partial<ModifierArg>) {\n    const { interaction } = this\n\n    arg.interaction = interaction\n    arg.interactable = interaction.interactable\n    arg.element = interaction.element\n    arg.rect ||= interaction.rect\n    arg.edges ||= this.startEdges\n    arg.startOffset = this.startOffset\n\n    return arg as ModifierArg\n  }\n\n  startAll (arg: MethodArg & Partial<ModifierArg>) {\n    for (const state of this.states) {\n      if (state.methods.start) {\n        arg.state = state\n        state.methods.start(arg as ModifierArg)\n      }\n    }\n  }\n\n  setAll (arg: MethodArg & Partial<ModifierArg>): ModificationResult {\n    const { phase, preEnd, skipModifiers, rect: unmodifiedRect, edges: unmodifiedEdges } = arg\n\n    arg.coords = extend({}, arg.pageCoords)\n    arg.rect = extend({}, unmodifiedRect)\n    arg.edges = extend({}, unmodifiedEdges)\n\n    const states = skipModifiers ? this.states.slice(skipModifiers) : this.states\n\n    const newResult = createResult(arg.coords, arg.rect)\n\n    for (const state of states) {\n      const { options } = state\n      const lastModifierCoords = extend({}, arg.coords)\n      let returnValue = null\n\n      if (state.methods?.set && this.shouldDo(options, preEnd, phase)) {\n        arg.state = state\n        returnValue = state.methods.set(arg as ModifierArg<never>)\n\n        rectUtils.addEdges(arg.edges, arg.rect, {\n          x: arg.coords.x - lastModifierCoords.x,\n          y: arg.coords.y - lastModifierCoords.y,\n        })\n      }\n\n      newResult.eventProps.push(returnValue)\n    }\n\n    extend(this.edges, arg.edges)\n\n    newResult.delta.x = arg.coords.x - arg.pageCoords.x\n    newResult.delta.y = arg.coords.y - arg.pageCoords.y\n\n    newResult.rectDelta.left = arg.rect.left - unmodifiedRect.left\n    newResult.rectDelta.right = arg.rect.right - unmodifiedRect.right\n    newResult.rectDelta.top = arg.rect.top - unmodifiedRect.top\n    newResult.rectDelta.bottom = arg.rect.bottom - unmodifiedRect.bottom\n\n    const prevCoords = this.result.coords\n    const prevRect = this.result.rect\n\n    if (prevCoords && prevRect) {\n      const rectChanged =\n        newResult.rect.left !== prevRect.left ||\n        newResult.rect.right !== prevRect.right ||\n        newResult.rect.top !== prevRect.top ||\n        newResult.rect.bottom !== prevRect.bottom\n\n      newResult.changed =\n        rectChanged || prevCoords.x !== newResult.coords.x || prevCoords.y !== newResult.coords.y\n    }\n\n    return newResult\n  }\n\n  applyToInteraction (arg: { phase: EventPhase, rect?: Rect }) {\n    const { interaction } = this\n    const { phase } = arg\n    const curCoords = interaction.coords.cur\n    const startCoords = interaction.coords.start\n    const { result, startDelta } = this\n    const curDelta = result.delta\n\n    if (phase === 'start') {\n      extend(this.startDelta, result.delta)\n    }\n\n    for (const [coordsSet, delta] of [\n      [startCoords, startDelta],\n      [curCoords, curDelta],\n    ] as const) {\n      coordsSet.page.x += delta.x\n      coordsSet.page.y += delta.y\n      coordsSet.client.x += delta.x\n      coordsSet.client.y += delta.y\n    }\n\n    const { rectDelta } = this.result\n    const rect = arg.rect || interaction.rect\n\n    rect.left += rectDelta.left\n    rect.right += rectDelta.right\n    rect.top += rectDelta.top\n    rect.bottom += rectDelta.bottom\n\n    rect.width = rect.right - rect.left\n    rect.height = rect.bottom - rect.top\n  }\n\n  setAndApply (\n    arg: Partial<DoAnyPhaseArg> & {\n      phase: EventPhase\n      preEnd?: boolean\n      skipModifiers?: number\n      modifiedCoords?: Point\n    },\n  ): void | false {\n    const { interaction } = this\n    const { phase, preEnd, skipModifiers } = arg\n\n    const result = this.setAll(\n      this.fillArg({\n        preEnd,\n        phase,\n        pageCoords: arg.modifiedCoords || interaction.coords.cur.page,\n      }),\n    )\n\n    this.result = result\n\n    // don't fire an action move if a modifier would keep the event in the same\n    // cordinates as before\n    if (\n      !result.changed &&\n      (!skipModifiers || skipModifiers < this.states.length) &&\n      interaction.interacting()\n    ) {\n      return false\n    }\n\n    if (arg.modifiedCoords) {\n      const { page } = interaction.coords.cur\n      const adjustment = {\n        x: arg.modifiedCoords.x - page.x,\n        y: arg.modifiedCoords.y - page.y,\n      }\n\n      result.coords.x += adjustment.x\n      result.coords.y += adjustment.y\n      result.delta.x += adjustment.x\n      result.delta.y += adjustment.y\n    }\n\n    this.applyToInteraction(arg)\n  }\n\n  beforeEnd (arg: Omit<DoAnyPhaseArg, 'iEvent'> & { state?: ModifierState }): void | false {\n    const { interaction, event } = arg\n    const states = this.states\n\n    if (!states || !states.length) {\n      return\n    }\n\n    let doPreend = false\n\n    for (const state of states) {\n      arg.state = state\n      const { options, methods } = state\n\n      const endPosition = methods.beforeEnd && methods.beforeEnd(arg as unknown as ModifierArg)\n\n      if (endPosition) {\n        this.endResult = endPosition\n        return false\n      }\n\n      doPreend = doPreend || (!doPreend && this.shouldDo(options, true, arg.phase, true))\n    }\n\n    if (doPreend) {\n      // trigger a final modified move before ending\n      interaction.move({ event, preEnd: true })\n    }\n  }\n\n  stop (arg: { interaction: Interaction }) {\n    const { interaction } = arg\n\n    if (!this.states || !this.states.length) {\n      return\n    }\n\n    const modifierArg: Partial<ModifierArg> = extend(\n      {\n        states: this.states,\n        interactable: interaction.interactable,\n        element: interaction.element,\n        rect: null,\n      },\n      arg,\n    )\n\n    this.fillArg(modifierArg)\n\n    for (const state of this.states) {\n      modifierArg.state = state\n\n      if (state.methods.stop) {\n        state.methods.stop(modifierArg as ModifierArg)\n      }\n    }\n\n    this.states = null\n    this.endResult = null\n  }\n\n  prepareStates (modifierList: Modifier[]) {\n    this.states = []\n\n    for (let index = 0; index < modifierList.length; index++) {\n      const { options, methods, name } = modifierList[index]\n\n      this.states.push({\n        options,\n        methods,\n        index,\n        name,\n      })\n    }\n\n    return this.states\n  }\n\n  restoreInteractionCoords ({ interaction: { coords, rect, modification } }: { interaction: Interaction }) {\n    if (!modification.result) return\n\n    const { startDelta } = modification\n    const { delta: curDelta, rectDelta } = modification.result\n\n    const coordsAndDeltas = [\n      [coords.start, startDelta],\n      [coords.cur, curDelta],\n    ]\n\n    for (const [coordsSet, delta] of coordsAndDeltas as any) {\n      coordsSet.page.x -= delta.x\n      coordsSet.page.y -= delta.y\n      coordsSet.client.x -= delta.x\n      coordsSet.client.y -= delta.y\n    }\n\n    rect.left -= rectDelta.left\n    rect.right -= rectDelta.right\n    rect.top -= rectDelta.top\n    rect.bottom -= rectDelta.bottom\n  }\n\n  shouldDo (options, preEnd?: boolean, phase?: string, requireEndOnly?: boolean) {\n    if (\n      // ignore disabled modifiers\n      !options ||\n      options.enabled === false ||\n      // check if we require endOnly option to fire move before end\n      (requireEndOnly && !options.endOnly) ||\n      // don't apply endOnly modifiers when not ending\n      (options.endOnly && !preEnd) ||\n      // check if modifier should run be applied on start\n      (phase === 'start' && !options.setStart)\n    ) {\n      return false\n    }\n\n    return true\n  }\n\n  copyFrom (other: Modification) {\n    this.startOffset = other.startOffset\n    this.startDelta = other.startDelta\n    this.startEdges = other.startEdges\n    this.edges = other.edges\n    this.states = other.states.map((s) => clone(s) as ModifierState)\n    this.result = createResult(extend({}, other.result.coords), extend({}, other.result.rect))\n  }\n\n  destroy () {\n    for (const prop in this) {\n      this[prop] = null\n    }\n  }\n}\n\nfunction createResult (coords?: Point, rect?: FullRect): ModificationResult {\n  return {\n    rect,\n    coords,\n    delta: { x: 0, y: 0 },\n    rectDelta: {\n      left: 0,\n      right: 0,\n      top: 0,\n      bottom: 0,\n    },\n    eventProps: [],\n    changed: true,\n  }\n}\n\nfunction getModifierList (interaction) {\n  const actionOptions = interaction.interactable.options[interaction.prepared.name]\n  const actionModifiers = actionOptions.modifiers\n\n  if (actionModifiers && actionModifiers.length) {\n    return actionModifiers\n  }\n\n  return ['snap', 'snapSize', 'snapEdges', 'restrict', 'restrictEdges', 'restrictSize']\n    .map((type) => {\n      const options = actionOptions[type]\n\n      return (\n        options &&\n        options.enabled && {\n          options,\n          methods: options._methods,\n        }\n      )\n    })\n    .filter((m) => !!m)\n}\n\nexport function getRectOffset (rect, coords) {\n  return rect\n    ? {\n      left: coords.x - rect.left,\n      top: coords.y - rect.top,\n      right: rect.right - coords.x,\n      bottom: rect.bottom - coords.y,\n    }\n    : {\n      left: 0,\n      top: 0,\n      right: 0,\n      bottom: 0,\n    }\n}\n"
	],
	"mappings": "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"
}